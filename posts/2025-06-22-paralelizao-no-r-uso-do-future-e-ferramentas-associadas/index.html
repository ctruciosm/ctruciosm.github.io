<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas</title>

<meta property="description" itemprop="description" content="Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código."/>

<link rel="canonical" href="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-06-22"/>
<meta property="article:created" itemprop="dateCreated" content="2025-06-22"/>
<meta name="article:author" content="João Victor Siqueira Rodrigues"/>
<meta name="article:author" content="Carlos Trucíos"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código."/>
<meta property="og:url" content="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"/>
<meta property="og:image" content="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/figuras/conceito_paralelizacao.png"/>
<meta property="og:image:width" content="1787"/>
<meta property="og:image:height" content="1050"/>
<meta property="og:locale" content="pt"/>
<meta property="og:site_name" content="Carlos Trucíos"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas"/>
<meta property="twitter:description" content="Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código."/>
<meta property="twitter:url" content="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"/>
<meta property="twitter:image" content="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/figuras/conceito_paralelizacao.png"/>
<meta property="twitter:image:width" content="1787"/>
<meta property="twitter:image:height" content="1050"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas"/>
<meta name="citation_fulltext_html_url" content="https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"/>
<meta name="citation_online_date" content="2025/06/22"/>
<meta name="citation_publication_date" content="2025/06/22"/>
<meta name="citation_author" content="João Victor Siqueira Rodrigues"/>
<meta name="citation_author_institution" content="Universidade Estadual de Campinas"/>
<meta name="citation_author" content="Carlos Trucíos"/>
<meta name="citation_author_institution" content="Universidade Estadual de Campinas"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Efficient r scientific workflows: Tools and tips;citation_publisher=GitHub Pages;citation_author=Selina Baldauf"/>
  <meta name="citation_reference" content="citation_title=Profvis: Interactive visualizations for profiling r code;citation_author=Hadley Wickham;citation_author=Winston Chang;citation_author=Javier Luraschi;citation_author=Timothy Mastny"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","categories","author","date","lang","output","draft","bibliography","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Paralelização no R: Uso do _future_ e ferramentas associadas"]},{"type":"character","attributes":{},"value":["Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código."]},{"type":"character","attributes":{},"value":["R"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["João Victor Siqueira Rodrigues"]},{"type":"character","attributes":{},"value":["Universidade Estadual de Campinas"]},{"type":"character","attributes":{},"value":["https://jsicas.github.io"]},{"type":"character","attributes":{},"value":["0009-0007-9732-5619"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Carlos Trucíos"]},{"type":"character","attributes":{},"value":["Universidade Estadual de Campinas"]},{"type":"character","attributes":{},"value":["https://ctruciosm.github.io"]},{"type":"character","attributes":{},"value":["0000-0001-8746-8877"]}]}]},{"type":"character","attributes":{},"value":["06-22-2025"]},{"type":"character","attributes":{},"value":["pt"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["statblog.bib"]},{"type":"character","attributes":{},"value":["https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"]},{"type":"character","attributes":{},"value":["https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["figuras/background-job.png","figuras/conceito_paralelizacao.png","figuras/fig1.png","figuras/fig2.png","figuras/fig3.png","figuras/furrr.png","figuras/future.png","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/anchor-4.2.2/anchor.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/bowser-1.9.3/bowser.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/distill-2.2.21/template.v2.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/figure-html5/microbenchmark-1.png","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/header-attrs-2.29/header-attrs.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/jquery-3.6.0/jquery-3.6.0.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/jquery-3.6.0/jquery-3.6.0.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/jquery-3.6.0/jquery-3.6.0.min.map","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/panelset-0.3.0/panelset.css","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/panelset-0.3.0/panelset.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/popper-2.6.0/popper.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/tippy-6.2.7/tippy-bundle.umd.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/tippy-6.2.7/tippy-light-border.css","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/tippy-6.2.7/tippy.css","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/tippy-6.2.7/tippy.umd.min.js","paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/webcomponents-2.0.0/webcomponents.js","profiler/profvis_1_files/d3-3.5.6/d3.min.js","profiler/profvis_1_files/d3-3.5.6/LICENSE","profiler/profvis_1_files/highlight-11.10.0/highlight.min.js","profiler/profvis_1_files/highlight-11.10.0/LICENSE","profiler/profvis_1_files/highlight-11.10.0/textmate.css","profiler/profvis_1_files/htmltools-fill-0.5.8.1/fill.css","profiler/profvis_1_files/htmlwidgets-1.6.4/htmlwidgets.js","profiler/profvis_1_files/jquery-3.7.1/AUTHORS.txt","profiler/profvis_1_files/jquery-3.7.1/jquery.min.js","profiler/profvis_1_files/profvis-0.3.6.9000/profvis.css","profiler/profvis_1_files/profvis-0.3.6.9000/profvis.js","profiler/profvis_1_files/profvis-0.3.6.9000/scroll.js","profiler/profvis_1_files/profvis-binding-0.4.0/profvis.js","profiler/profvis_1.html","statblog.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">@import url('https://fonts.googleapis.com/css2?family=Fira+Mono&family=IBM+Plex+Mono&family=IBM+Plex+Sans&family=IBM+Plex+Serif:ital,wght@1,600&family=Lato&display=swap');

/* Nord */
/*
 * Copyright (c) 2016-present Arctic Ice Studio <development@arcticicestudio.com>
 * Copyright (c) 2016-present Sven Greb <development@svengreb.de>
 *
 * Project:    Nord
 * Version:    0.2.0
 * Repository: https://github.com/arcticicestudio/nord
 * License:    MIT
 * References:
 *   https://www.w3.org/TR/css-variables
 *   https://www.w3.org/TR/selectors/#root-pseudo
 *   https://drafts.csswg.org/css-variables
 *   https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables
 *   http://warpspire.com/kss
 *   https://github.com/kss-node/kss-node
 */


:root {
  /*
  Base component color of "Polar Night".
  Used for texts, backgrounds, carets and structuring characters like curly- and square brackets.
  */
  --nord0: #2e3440;
  /*
  Lighter shade color of the base component color.
  Used as a lighter background color for UI elements like status bars.
  */
  --nord1: #3b4252;
  /*
  Lighter shade color of the base component color.
  Used as line highlighting in the editor.
  In the UI scope it may be used as selection- and highlight color.
  */
  --nord2: #434c5e;
  /*
  Lighter shade color of the base component color.
  Used for comments, invisibles, indent- and wrap guide marker.
  In the UI scope used as pseudoclass color for disabled elements.
  */
  --nord3: #4c566a;
  /*
  Base component color of "Snow Storm".
  Main color for text, variables, constants and attributes.
  In the UI scope used as semi-light background depending on the theme shading design.
  */
  --nord4: #d8dee9;
  /*
  Lighter shade color of the base component color.
  Used as a lighter background color for UI elements like status bars.
  Used as semi-light background depending on the theme shading design.
  */
  --nord5: #e5e9f0;
  /*
  Lighter shade color of the base component color.
  Used for punctuations, carets and structuring characters like curly- and square brackets.
  In the UI scope used as background, selection- and highlight color depending on the theme shading design.
  */
  --nord6: #eceff4;
  /*
  Bluish core color.
  Used for classes, types and documentation tags.
  */
  --nord7: #8fbcbb;
  /*
  Bluish core accent color.
  Represents the accent color of the color palette.
  Main color for primary UI elements and methods/functions.
  Can be used for
    - Markup quotes
    - Markup link URLs
  */
  --nord8: #88c0d0;
  /*
  Bluish core color.
  Used for language-specific syntactic/reserved support characters and keywords, operators, tags, units and
  punctuations like (semi)colons,commas and braces.
  */
  --nord9: #81a1c1;
  /*
  Bluish core color.
  Used for markup doctypes, import/include/require statements, pre-processor statements and at-rules (`@`).
  */
  --nord10: #5e81ac;
  /*
  Colorful component color.
  Used for errors, git/diff deletion and linter marker.
  */
  --nord11: #bf616a;
  /*
  Colorful component color.
  Used for annotations.
  */
  --nord12: #d08770;
  /*
  Colorful component color.
  Used for escape characters, regular expressions and markup entities.
  In the UI scope used for warnings and git/diff renamings.
  */
  --nord13: #ebcb8b;
  /*
  Colorful component color.
  Main color for strings and attribute values.
  In the UI scope used for git/diff additions and success visualizations.
  */
  --nord14: #a3be8c;
  /*
  Colorful component color.
  Used for numbers.
  */
  --nord15: #b48ead;
}


/* Theme */
:root {
  --primary: #000000; /*#388e00; */
}

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      var(--nord0);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    'IBM Plex Sans', sans-serif;
  --mono-font:       'IBM Plex Mono', monospace;
  --body-font:       'IBM Plex Sans', sans-serif;
  --navbar-font:     'IBM Plex Sans', serif; /* websites + blogs only */
}

/*-- Main section --*/
d-article,
d-appendix,
body {
  background-color: var(--nord5); /* var(--nord5); */
  color: var(--nord0);
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        17px;
  --hover-color:      var(--node03);
  --bkgd-color:       rgba(210, 210, 210, 0.6); 
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.6);
  --text-size:        15px;
  --hover-color:      var(--primary);
  --bkgd-color:       rgba(210, 210, 210, 0.8);
}



/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */



/* Code Folding by Thomas Mock https://themockup.blog/about.html */
details {
  background-color: hsla(60, 7%, 80%, 0.2);
  cursor: pointer;
  color: #2d2d2d;
  margin-bottom:1vh;
  padding: 1em;
  border: none;
  text-align: left;
  outline: none;
}


.active, details:hover {
  transition: max-height 0.2s ease-out;
}

details {
  display: flex;
  justify-content: space-between;
  align-content: center;
  border-radius: 4px;
}

details.active {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

summary::-webkit-details-marker {
  display: none
}

summary::after {
  float: right;
  font-family: "Font Awesome 5 Free";
  content: "\f0fe";
}

details[open] summary::after {
  float: right;
  font-family: "Font Awesome 5 Free";
  content: "\f146";
}

details h4 {
  margin: 0;
  color: #2d2d2d !important;
  line-height: inherit;
}


.btn-outline-dark {
    background-color: var(--nord4); /* #aaaaaa; */
    color: var(--nord0);/*#fff; */
    border: 5px;
}

.btn-outline-dark:hover {
    background-color: #dddddd;
    color: #000000;
}


/* Scrollbar */
/* Works on Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--primary);  var(--nord1);
}

/* Works on Chrome, Edge, and Safari */
*::-webkit-scrollbar {
  width: 12px;
}


*::-webkit-scrollbar-thumb {
  background-color: var(--nord1);
  border-radius: 12px;
  border: 1px solid var(--nord5);
}

/* Listing Pages */
.posts-list .post-preview {
  max-width: 85%;
  margin-left: auto;
  margin-right: auto;
}

/* Darkmode */
.darkmode {
  --title-color:     var(--nord5);
  --header-color:    var(--nord5);
  --body-color:      var(--nord5);
  --aside-color:     var(--nord5);
  --fig-cap-color:   var(--nord5);
  background-color: var(--nord0);
  color: var(--nord5);
}

.darkmode d-article,
.darkmode d-appendix,
.darkmode body {
  background-color: var(--nord0);
  color: var(--nord5);
}

.darkmode d-title {
  color: var(--nord5);
}

.darkmode d-article blockquote {
  color: var(--nord5);
}

.darkmode d-byline {
  --heading-color:  var(--nord5);
  --body-color:     var(--nord5);
}

.darkmode d-appendix {
  border-color: var(--nord4);
  --heading-color:   var(--nord5);
  --text-color:      var(--nord5);
}

.darkmode d-appendix a {
  color: var(--nord5);
}

.darkmode .distill-site-header {
  --text-color: var(--nord5);
  --bkgd-color: var(--nord1);
}

.darkmode .distill-site-footer {
  --text-color: var(--nord5);
  --bkgd-color: var(--nord1);
}


.darkmode d-article div.sourceCode,
.darkmode code {
  background-color: var(--nord1);
}

.darkmode d-article pre {
  color: var(--nord4);
}

.darkmode code span {
  color: var(--nord6);
}

.darkmode a {
  border-color: var(--nord5);
}

.darkmode .posts-list .post-preview {
  border-color: var(--nord5);
}

.darkmode a:hover {
  border-color: var(--primary);
}

.darkmode .categories li > * {
  color: var(--nord5);
}

.darkmode .posts-list .dt-tags .dt-tag,
.darkmode .dt-tags .dt-tag {
  color: var(--nord5);
  border-color: var(--nord5);
}

.darkmode d-article .sourceCode {
  background-color: var(--nord1);
}

.darkmode details {
  color: var(--nord4);
}

.darkmode .algolia-autocomplete,
.darkmode .algolia-autocomplete .aa-input,
.darkmode .algolia-autocomplete .aa-dropdown-menu,
.darkmode .algolia-autocomplete div .search-item,
.darkmode .algolia-autocomplete .aa-hint {
  background-color: var(--nord1);
  color: var(--nord5);
}

.darkmode .social_footer {
  color: var(--nord5);
}

.darkmode #fs-frm input:focus,
.darkmode #fs-frm [type="submit"]:hover,
.darkmode #fs-frm [type="submit"] input:focus,
.darkmode #fs-frm select:focus,
.darkmode #fs-frm textarea:focus {
  background-color: var(--nord2);
}

.darkmode #fs-frm input,
.darkmode #fs-frm select,
.darkmode #fs-frm textarea,
.darkmode #fs-frm #card-element {
  border: 1px solid var(--nord1);
  background-color: var(--nord1);
}


.darkmode div.datatables,
.darkmode table.dataTable.stripe tbody tr.odd, .darkmode table.dataTable.display tbody tr.odd,
.darkmode table.dataTable tbody tr,
.darkmode input,
.darkmode .dataTables_wrapper .dataTables_length,
.darkmode .dataTables_wrapper .dataTables_filter,
.darkmode .dataTables_wrapper .dataTables_info,
.darkmode .dataTables_wrapper .dataTables_processing,
.darkmode .dataTables_wrapper .dataTables_paginate {
  color: var(--nord4);
  background-color: var(--nord1);
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <link href="../../site_libs/panelset-0.3.0/panelset.css" rel="stylesheet" />
  <script src="../../site_libs/panelset-0.3.0/panelset.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">


<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Paralelização no R: Uso do _future_ e ferramentas associadas","description":"Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código.","authors":[{"author":"João Victor Siqueira Rodrigues","authorURL":"https://jsicas.github.io","affiliation":"Universidade Estadual de Campinas","affiliationURL":"#","orcidID":"0009-0007-9732-5619"},{"author":"Carlos Trucíos","authorURL":"https://ctruciosm.github.io","affiliation":"Universidade Estadual de Campinas","affiliationURL":"#","orcidID":"0000-0001-8746-8877"}],"publishedDate":"2025-06-22T00:00:00.000-05:00","citationText":"Rodrigues & Trucíos, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Carlos Trucíos</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../research.html">Research</a>
<a href="../../teaching.html">Teaching</a>
<a href="../../talks.html">Talks</a>
<a href="../../software.html">Software</a>
<a href="../../awards.html">Awards</a>
<a href="../../statblog.html">Blog</a>
<a href="../../links.html">Links</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
2025.2
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../ME315.html">ME315</a>
<a href="../../ME414.html">ME414</a>
<a href="http://www.ime.unicamp.br/carefs/">CAREFS</a>
<a href="http://www.ime.unicamp.br/julialang/">Julia</a>
</div>
</div>
<a>
<i class="fas fa-adjust" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Paralelização no R: Uso do future e ferramentas associadas</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../statblog.html#category:R" class="dt-tag">R</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Este post aborda a paralelização como uma estratégia para reduzir o tempo de execução de scripts, permitindo o uso eficiente de múltiplos núcleos ou máquinas. São apresentadas diferentes formas de distribuição de tarefas, como execução sequencial, sessões independentes e clusters. Além disso, é discutido como identificar gargalos de processamento por meio de medições e testar alternativas para otimizar o código.</p></p>
</div>

<div class="d-byline">
  João Victor Siqueira Rodrigues <a href="https://jsicas.github.io" class="uri">https://jsicas.github.io</a> (Universidade Estadual de Campinas)
  
,   Carlos Trucíos <a href="https://ctruciosm.github.io" class="uri">https://ctruciosm.github.io</a> (Universidade Estadual de Campinas)
  
<br/>06-22-2025
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introdução" id="toc-introdução">Introdução</a></li>
<li><a href="#paralelização" id="toc-paralelização">Paralelização</a>
<ul>
<li><a href="#o-pacote-future" id="toc-o-pacote-future">O pacote <code>future</code></a></li>
<li><a href="#o-pacote-furrr" id="toc-o-pacote-furrr">O Pacote <code>furrr</code></a></li>
<li><a href="#o-pacote-dofuture" id="toc-o-pacote-dofuture">O Pacote <code>doFuture</code></a></li>
<li><a href="#o-pacote-future.apply" id="toc-o-pacote-future.apply">O Pacote <code>future.apply</code></a></li>
</ul></li>
<li><a href="#exemplos-adicionais" id="toc-exemplos-adicionais">Exemplos Adicionais</a>
<ul>
<li><a href="#exemplo-1-slow_sqrt" id="toc-exemplo-1-slow_sqrt">Exemplo 1: <code>slow_sqrt</code></a></li>
<li><a href="#exemplo-2-números-aleatórios" id="toc-exemplo-2-números-aleatórios">Exemplo 2: Números Aleatórios</a></li>
</ul></li>
<li><a href="#eficiência-de-código" id="toc-eficiência-de-código">Eficiência de Código</a>
<ul>
<li><a href="#profiler" id="toc-profiler">Profiler</a></li>
<li><a href="#benchmark" id="toc-benchmark">Benchmark</a></li>
</ul></li>
<li><a href="#comentários-finais" id="toc-comentários-finais">Comentários Finais</a></li>
</ul>
</nav>
</div>
<!-- Configurações iniciais --->
<style>
  body {
    text-align: justify;
  }
</style>
<!-- Início do Documento --->
<h1 id="introdução">Introdução</h1>
<p>É bem sabido por estatísticos, econometristas, cientistas e analistas de dados que, tanto <code>R</code> quanto <code>Python</code> não são linguagens particularmente rápidas. Assim, otimizar o desempenho dos códigos torna-se uma parte essencial da rotina de quem trabalha com estas linguagens. Neste post, focaremos na linguagem <code>R</code> e no uso de recursos para paralelização.</p>
<aside>
Para quem busca desempenho e praticidade, uma linguagem bastante promissora é <code>Julia</code>. Uma excelente iniciativa para começar a aprender essa linguagem é o projeto <a href="https://ime.unicamp.br/julialang/">“Do Zero ao Julia”</a>, que oferece recursos introdutórios em português.
</aside>
<blockquote>
<p>Outro caminho para otimizar o desempenho, além da já famosa vetorização, é através do C++, cuja integração com o <code>R</code> pode ser realizada utilizando o pacote <code>Rcpp</code>.</p>
</blockquote>
<p>A computação paralela é uma técnica que divide um grande problema em pequenas tarefas, as quais são resolvidas de forma descentralizada podendo ser processadas em vários núcleos de um computador ou entre computadores, normalmente, sendo mais rápido do que processar as tarefas de forma sequencial <span class="citation" data-cites="ibm:2024">(<a href="#ref-ibm:2024" role="doc-biblioref">Flinders e Smalley 2024</a>)</span>. A computação paralela é resposta a uma busca por maior velocidade de execução dos <code>scripts</code>, motivada pelo interesse em aumentar a eficiência do código em uma era em que modelos cada vez mais complexos são propostos na literatura.</p>
<p>Este post apresenta as algumas das principais formas de paralelizar funções no <code>R</code>, além de mostrar como identificar gargalos de processamento e testar alternativas para melhorar a eficiência do código.</p>
<h1 id="paralelização">Paralelização</h1>
<!-- O que? -->
<p>Por padrão, o R utiliza apenas um núcleo do computador para processar suas tarefas. Paralelização permite a utilização de múltiplos núcleos, diminuindo assim o tempo de processamento.</p>
<!-- Como? -->
<p>A Figura <a href="#fig:paralelizacao">1</a> apresenta a ideia de como ocorre a paralelização de processos. Note que, ao utilzarmos processamento em paralelo, existe um tempo chamado de <em>overhead</em> que não estava presente no processamento sequencial. <em>Overhead</em> refere-se ao tempo necessário para coordenar e gerenciar tarefas tais como a comunicação entre os núcleos, divisão e agregação de tarefas, gerenciamento de memória, entre outros.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:paralelizacao"></span>
<img src="figuras/conceito_paralelizacao.png" alt="Conceito da paralelização" width="95%" />
<p class="caption">
Figure 1: Conceito da paralelização
</p>
</div>
</div>
<p>A forma apresentada de paralelização no post abordará 3 dos principais pacotes que utilizam o <em>framework</em> do pacote <a href="https://future.futureverse.org/"><code>future</code></a>, sendo eles os pacotes <a href="https://furrr.futureverse.org/"><code>furrr</code></a>, <a href="https://dofuture.futureverse.org/"><code>doFuture</code></a> e <a href="https://future.apply.futureverse.org/"><code>future.apply</code></a>. É importante mencionar que, além dos pacotes aqui apresentados, existem outros que também podem ser utilizados.</p>
<h2 id="o-pacote-future">O pacote <code>future</code></h2>
<p><a href='https://future.futureverse.org/' target='_blank'>
<img src='figuras/future.png' style='width:120px; float:right; margin-left:20px;
  margin-right:5px;'
  alt='Icone do pacote future'>
</a>
O pacote <a href="https://future.futureverse.org/"><code>future</code></a>, parte do ecossistema <code>futureverse</code>, é um <em>framework</em> que unifica e simplifica a paralelização no <code>R</code>. Para isso, ele apresenta uma abstração do conceito de atribuição, permitindo o cálculo de valores de forma assíncrona (futura) e resolvidos via <em>futures</em>. Existem 4 planos para resolver um <em>future</em>:</p>
<ul>
<li><code>sequential</code>: resolve <em>futures</em> sequencialmente na sessão em utilização do <code>R</code>, sendo a forma padrão de funcionamento do <code>R</code>;</li>
<li><code>multisession</code>: resolve <em>futures</em> de forma assíncrona e paralelizada gerando, em segundo plano, novas sessões independentes do <code>R</code> que se comunicam com o processo principal;</li>
<li><code>multicore</code>: resolve <em>futures</em> de forma assíncrona e paralelizada gerando <em>forked R processes</em> que rodam em segundo plano. Não suportado em sistemas Windows;</li>
<li><code>cluster</code>: resolve <em>futures</em> de forma assíncrona e paralelizada em sessões independentes do <code>R</code>, normalmente utilizado para duas ou mais máquinas.</li>
</ul>
<p>Ademais, além de selecionar o plano, também é necessário escolher a quantidade de núcleos (<em>workers</em>) a serem utilizados, configurações definidas por meio da função <code>plan()</code>.</p>
<blockquote>
<p>Por exemplo, o comando <code>plan(multisession, workers = 3)</code> configura o plano como <code>multisession</code> e define a utilização de 3 <em>workers</em>.</p>
</blockquote>
<p>Além da função <code>plan()</code>, as seguintes funções são bastante úteis quando o interesse é paralelizar</p>
<ul>
<li><code>plan()</code>: define a estratégia a ser utilizada, além de, ao ser utilizada sem argumentos, retorna a estratégia atual;</li>
<li><code>availableCores()</code>: retorna a quantidade de núcleos que a máquina tem;</li>
<li><code>nbrOfWorkers()</code>: retorna a quantidade de <em>workers</em> definidos no comando <code>plan()</code>;</li>
<li><code>nbrOfFreeWorkers()</code>: retorna a quantidade de <em>workers</em> disponíveis, isto é, os que não estão executando nenhuma tarefa.</li>
</ul>
<p>Por exemplo, a seguir são apresentadas as configurações sem alteração do número de <em>workers</em>, de um dos autores no momento de escrever este post:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>sequential:
- args: function (..., envir = parent.frame(), workers = &quot;&lt;NULL&gt;&quot;)
- tweaked: FALSE
- call: NULL</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://parallelly.futureverse.org/reference/availableCores.html'>availableCores</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>system 
    12 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://future.futureverse.org/reference/nbrOfWorkers.html'>nbrOfWorkers</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 1</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://future.futureverse.org/reference/nbrOfWorkers.html'>nbrOfFreeWorkers</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 1</code></pre>
</div>
<h2 id="o-pacote-furrr">O Pacote <code>furrr</code></h2>
<p><a href='https://furrr.futureverse.org/' target='_blank'>
<img src='figuras/furrr.png' style='width:120px; float:right; margin-left:20px;
  margin-right:5px;'
  alt='Icone do pacote furrr'>
</a>
O pacote <a href="https://furrr.futureverse.org/"><code>furrr</code></a> busca combinar os comandos e ferramentas de <a href="http://adv-r.had.co.nz/Functional-programming.html">programação funcional</a> do pacote <a href="https://purrr.tidyverse.org/"><code>purrr</code></a> com o processamento em paralelo do <a href="https://future.futureverse.org/"><code>future</code></a>. Essa integração possibilita a execução paralela de funções de mapeamento com poucas alterações no código, sendo necessário acrescentar o prefixo <code>future_</code> às funções do <a href="https://purrr.tidyverse.org/"><code>purrr</code></a>. Por exemplo, a versão paralela da função <code>map()</code> é a <code>future_map()</code>, a versão paralela da função <code>imap()</code> é a <code>future_imap()</code>, e assim por diante.</p>
<!-- Exemplo -->
<p>A seguir, apresentamos um exemplo para ilustrar como utilizar a função <code>future_map_dbl()</code> para aplicar a função <code>log()</code> nos elementos de um vetor utilizando 2 <em>workers</em>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/DavisVaughan/furrr'>furrr</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>  <span class='co'># paralelizar utilizando 2 núcleos</span></span>
<span></span>
<span><span class='va'>vet</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, <span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span>  <span class='co'># vetor para teste</span></span>
<span><span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map_dbl</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='va'>log</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.6931472 1.0000000 2.3025851 2.9957323</code></pre>
</div>
<p>Na prática, é comum o uso de funções mais complexas, as quais poderão ser incluidas através de duas formas: (a) por meio de <a href="http://adv-r.had.co.nz/Functional-programming.html#anonymous-functions">funções anônimas</a>, criadas a partir de <code>function(x) {...}</code> (ou <code>\(x) {...}</code>, para versões superiores ao R 4.1.0) e (b) por medio de uma forma exclusiva do <a href="https://purrr.tidyverse.org/"><code>furrr</code></a>. Para ilustrar isto, veja o exemplo a seguir:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># forma 1</span></span>
<span><span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span><span class='va'>vet</span>, \<span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'log'</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>, <span class='st'>'quadrado'</span> <span class='op'>=</span> <span class='va'>i</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='op'>}</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># forma 2 (exclusiva do furrr)</span></span>
<span><span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'log'</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, <span class='st'>'quadrado'</span> <span class='op'>=</span> <span class='va'>.x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># resultado</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='va'>f1</span>, <span class='va'>f2</span><span class='op'>)</span>  <span class='co'># TRUE</span></span></code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>f1</span>  </span></code></pre>
</div>
<pre><code>[[1]]
      log  quadrado 
0.6931472 4.0000000 

[[2]]
     log quadrado 
1.000000 7.389056 

[[3]]
       log   quadrado 
  2.302585 100.000000 

[[4]]
       log   quadrado 
  2.995732 400.000000 </code></pre>
</div>
<h2 id="o-pacote-dofuture">O Pacote <code>doFuture</code></h2>
<p>O pacote <a href="https://dofuture.futureverse.org/"><code>doFuture</code></a> é outra alternativa para realizar a paralelização de processos. Ele pode ser utilizado de duas formas: a primeira, mais recomendada, é através do operador <code>%dofuture%</code>, enquanto a segunda, menos recomendada, é através do operador <code>%dopar%</code>.</p>
<!-- Exemplo -->
<p>A seguir, será utilizado o pacote <a href="https://dofuture.futureverse.org/"><code>doFuture</code></a> para aplicar a função <span class="math inline">\(log()\)</span> nos elementos de um vetor utilizando 2 núcleos e retornar um vetor como saída.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://doFuture.futureverse.org'>doFuture</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>  <span class='co'># paralelizar utilizando 2 núcleos</span></span>
<span></span>
<span><span class='va'>vet</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, <span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span>  <span class='co'># vetor para teste</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/foreach/man/foreach.html'>foreach</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='va'>vet</span>, .combine <span class='op'>=</span> <span class='va'>c</span><span class='op'>)</span> <span class='op'><a href='https://doFuture.futureverse.org/reference/grapes-dofuture-grapes.html'>%dofuture%</a></span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
<pre><code>[1] 0.6931472 1.0000000 2.3025851 2.9957323</code></pre>
</div>
<p>Vale ressaltar que a saída padrão do <code>foreach()</code> é em formato de lista. Contudo, é possível configurá-la por meio do argumento <code>.combine</code>, que neste caso foi ajustada para ter um vetor como resultado. Além disso, destaca-se que o <code>foreach()</code> <strong>NÃO</strong> é um um for-loop, para mais detalhes, veja <span class="citation" data-cites="bengtsson_foreach">(<a href="#ref-bengtsson_foreach" role="doc-biblioref">Bengtsson 2022</a>, Apêndice 8.8)</span>.</p>
<h2 id="o-pacote-future.apply">O Pacote <code>future.apply</code></h2>
<p>O pacote <a href="https://future.apply.futureverse.org/"><code>future.apply</code></a> estende as funções da base do R que aplicam operações à vetores, matrizes e listas, permitindo a execução de forma paralela com o suporte do <em>framework</em> do <a href="https://future.futureverse.org/"><code>future</code></a>. Este pacote fornece versões paralelizáveis de funções da família <code>apply()</code> presente na base do R, bastando adicionar o prefixo <code>future_</code>.</p>
<!-- Exemplo -->
<p>A seguir, está apresentado como utilizar o pacote <a href="https://future.apply.futureverse.org/"><code>future.apply</code></a> para aplicar a função <span class="math inline">\(log()\)</span> nos elementos de um vetor utilizando 2 núcleos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://future.apply.futureverse.org'>future.apply</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>  <span class='co'># paralelizar utilizando 2 núcleos</span></span>
<span></span>
<span><span class='va'>vet</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, <span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span>  <span class='co'># vetor para teste</span></span>
<span><span class='fu'><a href='https://future.apply.futureverse.org/reference/future_lapply.html'>future_sapply</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='va'>log</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.6931472 1.0000000 2.3025851 2.9957323</code></pre>
</div>
<p>Além do <code>future_sapply()</code>, temos também o <code>future_apply()</code> e o <code>future_lapply()</code>.</p>
<h1 id="exemplos-adicionais">Exemplos Adicionais</h1>
<p>Nesta section dois exemplos adicionais serão abordados, o primeiro, relativo à comparação do tempo de execução com e sem paralelização considerando os pacotes apresentados, enquanto o segundo discutirá brevemente a geração de números aleatórios e cuidados necessários ao utilizar em conjunto com a computação paralela.</p>
<h2 id="exemplo-1-slow_sqrt">Exemplo 1: <code>slow_sqrt</code></h2>
<p>Será aplicado a função <code>slow_sqrt()</code>, a qual espera 1 segundo e calcula a raiz quadrada do valor de entrada. Além disso, será apresentado o tempo de execução para aplicar essa função em cada elemento de um vetor de tamanho 60 com e sem paralelização.</p>
<p>Primeiro será feito o setup necessário:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://future.futureverse.org'>future</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>  <span class='co'># paralelizar utilizando 5 núcleos</span></span>
<span><span class='co'># função slow_sqrt</span></span>
<span><span class='va'>slow_sqrt</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/Sys.sleep.html'>Sys.sleep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>  <span class='co'># simula 1 segundo de processamento</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># execução sem paralelização</span></span>
<span><span class='va'>vet</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>60</span>  <span class='co'># vetor para teste</span></span></code></pre>
</div>
</div>
<p>A seguir, a comparação utilizando processamento sequencual e as versões em paralelo</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html'>microbenchmark</a></span><span class='op'>(</span>M1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='va'>slow_sqrt</span><span class='op'>)</span>, </span>
<span>               M2 <span class='op'>=</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='va'>slow_sqrt</span><span class='op'>)</span>,</span>
<span>               M3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/foreach/man/foreach.html'>foreach</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='va'>vet</span><span class='op'>)</span> <span class='op'><a href='https://doFuture.futureverse.org/reference/grapes-dofuture-grapes.html'>%dofuture%</a></span> <span class='op'>{</span></span>
<span>                      <span class='fu'>slow_sqrt</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span></span>
<span>                    <span class='op'>}</span>,</span>
<span>               M4 <span class='op'>=</span> <span class='fu'><a href='https://future.apply.futureverse.org/reference/future_lapply.html'>future_lapply</a></span><span class='op'>(</span><span class='va'>vet</span>, <span class='va'>slow_sqrt</span><span class='op'>)</span>, times <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>Unit: seconds
 expr      min       lq     mean   median       uq      max neval
   M1 59.25603 59.26126 59.31608 59.26598 59.40455 59.48470    10
   M2 12.01358 12.01692 12.15005 12.02559 12.05385 13.23094    10
   M3 12.00944 12.02402 12.03647 12.02777 12.06402 12.06695    10
   M4 12.00339 12.01313 12.02976 12.01728 12.05871 12.06682    10</code></pre>
</div>
<h2 id="exemplo-2-números-aleatórios">Exemplo 2: Números Aleatórios</h2>
<p>Considere as variáveis aleatórias <span class="math inline">\(X_1 \sim \mathcal{N}(0,1)\)</span>, <span class="math inline">\(X_2 \sim \mathcal{N}(10, 5)\)</span> e <span class="math inline">\(X_3 \sim \mathcal{N}(50, 8)\)</span>. Deverá ser gerado uma amostra com 1000 observações para cada variável aleatória apresentada e calculado o mínimo, média, variância e máximo utilizando <span class="math inline">\(4\)</span> núcleos considerando a <em>seed</em> 123.</p>
<p>Primeiro será feito o setup necessário:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>  <span class='co'># paralelizar utilizando 4 núcleos</span></span>
<span></span>
<span><span class='co'># execução sem paralelização</span></span>
<span><span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>10</span>, <span class='fl'>50</span><span class='op'>)</span></span>
<span><span class='va'>sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>8</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, \<span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>amostra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='va'>mu</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='va'>sigma</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># gerando amostra</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'min'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'media'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'var'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'max'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[[1]]
        min       media         var         max 
-2.80977468  0.01612787  0.98345893  3.24103993 

[[2]]
      min     media       var       max 
-5.239304 10.212326 25.486049 26.951854 

[[3]]
     min    media      var      max 
27.21163 49.83910 61.25973 77.36876 </code></pre>
</div>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">furrr</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># forma 1</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, \<span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>amostra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='va'>mu</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='va'>sigma</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># gerando amostra</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'min'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'media'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'var'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'max'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span>, .options <span class='op'>=</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/furrr_options.html'>furrr_options</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># forma 2 (exclusiva do furrr)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, <span class='op'>~</span> <span class='op'>{</span></span>
<span>  <span class='va'>amostra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='va'>mu</span><span class='op'>[</span><span class='va'>.x</span><span class='op'>]</span>, <span class='va'>sigma</span><span class='op'>[</span><span class='va'>.x</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># gerando amostra</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'min'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'media'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'var'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'max'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span>, .options <span class='op'>=</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/furrr_options.html'>furrr_options</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># resultado</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='va'>f1</span>, <span class='va'>f2</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>f1</span></span></code></pre>
</div>
<pre><code>[[1]]
        min       media         var         max 
-3.06732143 -0.01880173  1.10208379  3.40602221 

[[2]]
      min     media       var       max 
-4.215841 10.052563 25.919922 26.973502 

[[3]]
     min    media      var      max 
26.47221 50.12970 62.78559 73.13110 </code></pre>
</div>
</div>
<div class="panel">
<p><span class="panel-name">doFuture</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/foreach/man/foreach.html'>foreach</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, .options.future <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://doFuture.futureverse.org/reference/grapes-dofuture-grapes.html'>%dofuture%</a></span> <span class='op'>{</span></span>
<span>  <span class='va'>amostra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='va'>mu</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='va'>sigma</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># gerando amostra</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'min'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'media'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'var'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'max'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
<pre><code>[[1]]
        min       media         var         max 
-3.06732143 -0.01880173  1.10208379  3.40602221 

[[2]]
      min     media       var       max 
-4.215841 10.052563 25.919922 26.973502 

[[3]]
     min    media      var      max 
26.47221 50.12970 62.78559 73.13110 </code></pre>
</div>
</div>
<div class="panel">
<p><span class="panel-name">future.apply</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://future.apply.futureverse.org/reference/future_lapply.html'>future_lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, \<span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>amostra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='va'>mu</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='va'>sigma</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># gerando amostra</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'min'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'media'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'var'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span>, <span class='st'>'max'</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amostra</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span>, future.seed <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[[1]]
        min       media         var         max 
-3.06732143 -0.01880173  1.10208379  3.40602221 

[[2]]
      min     media       var       max 
-4.215841 10.052563 25.919922 26.973502 

[[3]]
     min    media      var      max 
26.47221 50.12970 62.78559 73.13110 </code></pre>
</div>
</div>
</div>
<p>Veja que o resultado utilizando a paralelização diverge do que foi encontrado ao não utilizá-la. Além disso, note que há um argumento referende à seed em cada função dos pacotes apresentados, por exemplo, para o pacote <a href="https://furrr.futureverse.org/"><code>furrr</code></a> é utilizado o argumento <code>.options = furrr_options(seed = TRUE)</code>. Estes argumentos são responsáveis por manter a reprodutibilidade na geração de números pseudo-aleatórios através do gerador L’Ecuyer-CMRG (utilizado pelo <a href="https://future.futureverse.org/"><code>future</code></a>), já que o Mersenne-Twister (gerador padrão do R) não foi idealizado para trabalhar com paralelização, podendo gerar números correlacionados entre os <em>workers</em>, causando viés e conclusões equivocadas.</p>
<p>Assim, como os geradores são diferentes, o resultado não é o mesmo, contudo, ambos são válidos, isto é, todos são amostras das respectivas normais apresentadas.</p>
<h1 id="eficiência-de-código">Eficiência de Código</h1>
<p>A busca por soluções que diminuem o tempo de processamento computacional (como a computação paralela) vem acompanhadas da preocupação com a sua eficiência. Isto, pois ao se escrever um código mais eficiente, o tempo de execução tende a diminuir. No entanto, nem sempre vale a pena investir tempo na otimização prematura do código. Antes disso, é fundamental avaliar cuidadosamente se esse esforço é realmente necessário <span class="citation" data-cites="selina:2023">(<a href="#ref-selina:2023" role="doc-biblioref">Baldauf 2023</a>)</span>:</p>
<ul>
<li>Quanto tempo é salvo pela otimização?</li>
<li>Qual a frequência que este código é executado?</li>
<li>Quanto tempo será necessários para otimizar o código?</li>
</ul>
<p>Aassumindo que é necessária a otimização no código, torna-se importante detectar quais as linhas que mais consomem tempo. Para isso, ferramentas bastantes úteis são os pacotes <a href="https://profvis.r-lib.org/index.html"><code>profvis</code></a> para detecção do gargalo no processamento e <a href="https://www.rdocumentation.org/packages/microbenchmark/versions/1.5.0/topics/microbenchmark"><code>microbenchmark</code></a> para testar tempo de processamento de diversas alternativas, como realizado no exemplo 1.</p>
<p><strong>Importante: </strong> algumas boas práticas que podem ajudar a reduzir o tempo de processamento <span class="citation" data-cites="selina:2023">(<a href="#ref-selina:2023" role="doc-biblioref">Baldauf 2023</a>)</span>:</p>
<ul>
<li>Quando necessário, armazenar resultados intermediários constatemente utilizados para evitar o recálculo;</li>
<li>Preferir vetorizar o código e substituir for-loops por funções vetorizadas;</li>
<li>Não paralelizar processos muito simples devido ao <em>overhead</em>;</li>
<li>Evitar manipular objetos grandes na paralelização.</li>
</ul>
<h2 id="profiler">Profiler</h2>
<p>Para identificar as partes críticas do código, isto é, o gargalo do processamento pode-se utilizar o pacote <a href="https://profvis.r-lib.org/index.html"><code>profvis</code></a>, o qual examina o tempo gasto em cada função de determinada parte do script. Seu acesso se dá por <code>Profile &gt; Start Profiling</code> (e <code>Profile &gt; Stop Profiling</code> para finalizar) na barra de ferramentas do Rstudio ou através da função <code>profvis()</code>.</p>
<!-- exemplo profvis -->
<p>Veja um exemplo abaixo (adaptado de <span class="citation" data-cites="profvis">Wickham et al. (<a href="#ref-profvis" role="doc-biblioref">2024</a>)</span>):</p>
<!-- ATENÇÃO COM ESTE CHUNK-->
<!-- ATENÇÃO COM ESTE CHUNK-->
<!-- ATENÇÃO COM ESTE CHUNK-->
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://profvis.r-lib.org'>profvis</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># funções</span></span>
<span><span class='va'>h</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://profvis.r-lib.org/reference/pause.html'>pause</a></span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>g</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://profvis.r-lib.org/reference/pause.html'>pause</a></span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span></span>
<span>  <span class='fu'>h</span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://profvis.r-lib.org/reference/pause.html'>pause</a></span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span></span>
<span>  <span class='fu'>g</span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='fu'>h</span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># profiler</span></span>
<span><span class='fu'><a href='https://profvis.r-lib.org/reference/profvis.html'>profvis</a></span><span class='op'>(</span><span class='op'>{</span></span>
<span>  <span class='fu'>f</span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='fu'>g</span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='op'>}</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<iframe src="./profiler/profvis_1.html" height="400">
</iframe>
<p>Sua análise está dividida em duas abas, a primeira, <em>flame graph</em>, é apresentado o tempo e memória gastos em cada linha de código em conjunto com uma timeline das funções utilizadas e, a segunda, <em>Data</em>, apresenta o tempo gasto em cada função.</p>
<h2 id="benchmark">Benchmark</h2>
<p>Por último, o mesmo código pode ser escrito de várias formas diferentes, sendo necessário determinar qual delas é a mais rápida. Para isso existe o pacote <a href="https://www.rdocumentation.org/packages/microbenchmark/versions/1.5.0/topics/microbenchmark"><code>microbenchmark</code></a>, o qual auxilia na comparação entre as versões do mesmo código de forma sistematizada.</p>
<p>Considere comparar 3 funções diferentes cujo objetivo é calcular a soma de um vetor aplicando o logarítimo em cada elemento. A primeira, utiliza funções vetorizadas, a segunda e a terceira aplicam os comandos elemento à elemento, contudo, uma já aloca a memória necessária criando o vetor <code>x_log</code> do seu tamanho final, o que é mais eficiente.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/joshuaulrich/microbenchmark/'>microbenchmark</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># funções</span></span>
<span><span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>  <span class='co'># utilizando funções vetorizadas</span></span>
<span>  <span class='va'>x_log</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x_log</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>  <span class='co'># criando vetor do tamanho final (pré-alocando memória)</span></span>
<span>  <span class='va'>x_log</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>'numeric'</span>, length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># tamanho final</span></span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>x_log</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x_log</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>f3</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>  <span class='co'># utilizando o comando append() (ineficiente)</span></span>
<span>  <span class='va'>x_log</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>'numeric'</span>, length <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>  <span class='co'># tamanho 0</span></span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>x_log</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/append.html'>append</a></span><span class='op'>(</span><span class='va'>x_log</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x_log</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># vetor para teste </span></span>
<span><span class='va'>vet</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, size <span class='op'>=</span> <span class='fl'>3500</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># benchmark</span></span>
<span><span class='va'>comp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html'>microbenchmark</a></span><span class='op'>(</span></span>
<span>  <span class='st'>'forma 1'</span> <span class='op'>=</span> <span class='fu'>f1</span><span class='op'>(</span><span class='va'>vet</span><span class='op'>)</span>,</span>
<span>  <span class='st'>'forma 2'</span> <span class='op'>=</span> <span class='fu'>f2</span><span class='op'>(</span><span class='va'>vet</span><span class='op'>)</span>,</span>
<span>  <span class='st'>'forma 3'</span> <span class='op'>=</span> <span class='fu'>f3</span><span class='op'>(</span><span class='va'>vet</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># resultado</span></span>
<span><span class='va'>comp</span>  </span></code></pre>
</div>
<pre><code>Unit: microseconds
    expr       min        lq        mean     median         uq
 forma 1    23.452    25.051    36.90041    25.6660    27.3265
 forma 2   177.325   182.081   210.01061   184.3975   187.7800
 forma 3 15469.874 18693.376 19634.10378 19021.0890 19515.1390
       max neval
  1087.443   100
  2686.484   100
 76993.982   100</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># plot do resultado</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span><span class='va'>comp</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="paralelizao-no-r-uso-do-future-e-ferramentas-associadas_files/figure-html5/microbenchmark-1.png" width="624" /></p>
</div>
<p>Então, veja que a <em>forma 1</em>, isto é, a função <code>f1()</code>, é a mais eficiente (resultado esperado, afinal funções vetorizadas no R são mais eficientes que for-loops). Além disso, veja que a <em>forma 2</em> se sobressai referente à <em>forma 3</em>, haja vista que o vetor para armazenar o resultado <code>x_log</code> já é criado com o seu tamanho final, enquanto que a <em>forma 3</em> fica acrescentando ao final do vetor (na verdade o R faz uma cópia do objeto e faz o acréscimo do novo valor, logo, quanto maior for o objeto pior será o desempenho dessa proposta).</p>
<h1 id="comentários-finais">Comentários Finais</h1>
<ol type="1">
<li>Existe a alternativa de executar código como um <em>background job</em>. Para fazer isso no Rstudio basta buscar a aba de <em>background job</em> (Figura <a href="#fig:background-jobs">2</a>), selecionar o script e o diretório de trabalho e iniciar. Com isso, o script será executado em uma nova sessão, deixando o terminal disponível para utilização mesmo durante sua execução.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:background-jobs"></span>
<img src="figuras/background-job.png" alt="*Background jobs* no Rstudio" width="80%" />
<p class="caption">
Figure 2: <em>Background jobs</em> no Rstudio
</p>
</div>
</div>
<ol start="2" type="1">
<li><p>Uma estratégia interessante é escrever parte do código em C++ (através do pacote <code>Rcpp</code>) e paralelizar com, por exemplo, <code>future_apply()</code> (que é uma das formas mais fáceis aqui apresentadas). Infelizmente, as tentativas previas realizadas por um dos autores não foram satisfatórias. Uma solução foi utilizar o função <code>mclapply()</code> do pacote <code>parallel</code>.</p></li>
<li><p>A maior parte deste post foi escrita pelo primeiro autor, João Victor Siqueira Rodrigues, a pedido do segundo autor. Este último realizou pequenas modificações no texto original e acrescentou pequenos comentários. O Segundo autor agradece a João Victor pela disponibilidade e colaboração na elaboração de um conteúdo que, certamente, será útil para seus colegas.</p></li>
</ol>
<p><strong>Happy Coding!</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-selina:2023" class="csl-entry" role="listitem">
Baldauf, Selina. 2023. <em>Efficient R Scientific workflows: Tools and Tips</em>. GitHub Pages. <a href="https://selinazitrone.github.io/tools_and_tips/slides/2023_11_16_efficient_r.html#/title-slide">https://selinazitrone.github.io/tools_and_tips/slides/2023_11_16_efficient_r.html#/title-slide</a>.
</div>
<div id="ref-bengtsson_foreach" class="csl-entry" role="listitem">
Bengtsson, Henrik. 2022. <em>Future Framework: Parallel and Distributed Processing in R</em>. GitHub Pages. <a href="https://henrikbengtsson.github.io/future-tutorial-user2022/appendix.html#appendix-foreach-is-not-a-for-loop">https://henrikbengtsson.github.io/future-tutorial-user2022/appendix.html#appendix-foreach-is-not-a-for-loop</a>.
</div>
<div id="ref-ibm:2024" class="csl-entry" role="listitem">
Flinders, Mesh, e Ian Smalley. 2024. <em>What is parallel computing?</em> IBM. <a href="https://www.ibm.com/think/topics/parallel-computing">https://www.ibm.com/think/topics/parallel-computing</a>.
</div>
<div id="ref-profvis" class="csl-entry" role="listitem">
Wickham, Hadley, Winston Chang, Javier Luraschi, e Timothy Mastny. 2024. <em>profvis: Interactive Visualizations for Profiling R Code</em>. <a href="https://profvis.r-lib.org">https://profvis.r-lib.org</a>.
</div>
</div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fctruciosm.github.io%2Fposts%2F2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas%2F" aria-label="share on facebook">
        <i class="fab fa-facebook" aria-hidden="true"></i>
      </a>
      <a href="https://twitter.com/share?text=Paraleliza%C3%A7%C3%A3o%20no%20R%3A%20Uso%20do%20_future_%20e%20ferramentas%20associadas&amp;url=https%3A%2F%2Fctruciosm.github.io%2Fposts%2F2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas%2F" aria-label="share on twitter">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fctruciosm.github.io%2Fposts%2F2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas%2F&amp;title=Paraleliza%C3%A7%C3%A3o%20no%20R%3A%20Uso%20do%20_future_%20e%20ferramentas%20associadas" aria-label="share on linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
    </span>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<script>
const darkmodeToggle = document.getElementsByClassName("fas fa-adjust")[0];
let theme = localStorage.getItem("theme");

if (!theme) {
  if (window.matchMedia("(prefers-color-scheme: dark)").matches ) {
    theme = "dark";
  } else {
    theme = "light";
  }
}
setTheme();

function switchTheme() {
  if (theme === "light") {
    theme = "dark";
  } else {
    theme = "light";
  }
  localStorage.setItem("theme", theme);
  setTheme();
  console.log(theme);
}

function setTheme() {
  if (theme === "dark") {
    document.body.classList.add('darkmode');
  } else {
    document.body.classList.remove('darkmode');
  }
}

darkmodeToggle.addEventListener('click', switchTheme)
</script>
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Rodrigues &amp; Trucíos (2025, June 22). Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas. Retrieved from https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{rodrigues2025paralelização,
  author = {Rodrigues, João Victor Siqueira and Trucíos, Carlos},
  title = {Carlos Trucíos: Paralelização no R: Uso do _future_ e ferramentas associadas},
  url = {https://ctruciosm.github.io/posts/2025-06-22-paralelizao-no-r-uso-do-future-e-ferramentas-associadas/},
  year = {2025}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>Website created using <a href="https://www.rstudio.com"><strong>Rstudio</strong></a> and the R
packages <a href="https://rstudio.github.io/distill/"><strong>distill</strong></a>,
<a href="https://github.com/hadley/emo"><strong>emo</strong></a>, <a href="https://github.com/seankross/postcards"><strong>postcards</strong></a>,
<a href="https://rmarkdown.rstudio.com"><strong>Rmarkdown</strong></a>
and <a href="https://github.com/gadenbuie/xaringanExtra"><strong>xaringanExtra</strong></a>.</p>
<p>Content licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA
4.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
